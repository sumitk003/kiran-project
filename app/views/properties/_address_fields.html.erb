<%= tag.div class: 'w-full', data: { controller: 'address-search', address_search_classes_value: 'opacity-100 opacity-0 hidden block', address_search_url_value: address_search_index_path, address_search_param_value: 'address' } do %>

  <!-- Search command palette, hidden by default -->
  <%= tag.div class: 'opacity-0 hidden', data: { address_search_target: 'searchPalette' } do %>
    <%= tag.div class: 'fixed inset-0 z-10 overflow-y-auto p-4 sm:p-6 md:p-20', role: 'dialog', aria_model: 'true' do %>
      <!--
        Background overlay, show/hide based on modal state.

        Entering: "ease-out duration-300"
          From: "opacity-0"
          To: "opacity-100"
        Leaving: "ease-in duration-200"
          From: "opacity-100"
          To: "opacity-0"
      -->
      <div class="fixed inset-0 bg-gray-500 bg-opacity-25 transition-opacity" aria-hidden="true" data-action="click->address-search#close"></div>
      <!--
        Command palette, show/hide based on modal state.

        Entering: "ease-out duration-300"
          From: "opacity-0 scale-95"
          To: "opacity-100 scale-100"
        Leaving: "ease-in duration-200"
          From: "opacity-100 scale-100"
          To: "opacity-0 scale-95"
      -->
      <div class="mx-auto max-w-xl transform divide-y divide-gray-100 overflow-hidden rounded-xl bg-white shadow-2xl ring-1 ring-black ring-opacity-5 transition-all">
        <div class="relative">
          <!-- Heroicon name: solid/search -->
          <svg class="pointer-events-none absolute top-3.5 left-4 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
          </svg>
          <%= form_with url: address_search_index_path, method: :get do |search_form| %>
            <%= search_form.text_field :search, autocomplete: "off", data: { action: 'address-search#input keydown->address-search#manage_keypress keyup->address-search#manage_keypress', address_search_target: "focus" }, class: 'h-12 w-full border-0 bg-transparent pl-11 pr-4 text-gray-800 placeholder-gray-400 focus:ring-0 sm:text-sm', aria_expanded: "false", aria_controls: "options" %>
          <% end %>
        </div>

        <!-- Results, show/hide based on command palette state -->
        <ul class="max-h-72 scroll-py-2 overflow-y-auto py-2 text-sm text-gray-800" id="address-search-results" role="listbox" data-address-search-target="results">
        </ul>
      </div>
    <% end %>
  <% end %>

  <%= tag.div class: 'col-span-6 sm:col-span-6 pb-6' do %>

    <div class="col-span-6 sm:col-span-6">
      <%= render FormLabelComponent.new(form: form, name: :search_address) %>
      <%= render FormTextFieldComponent.new(form: form, name: :search_address, type: :text, data: { action: "focus->address-search#toggle input->address-search#input", address_search_target: "focus" }) %>
    </div>

  <% end %>

  <div class="col-span-6 sm:col-span-6" >
    <div class="grid grid-cols-6 gap-6">
      <div class="col-span-6 sm:col-span-2">
        <%= render FormLabelComponent.new(form: form, name: :street_number) %>
        <%= render FormTextFieldComponent.new(form: form, name: :street_number, type: :text, data: { address_search_target: :streetNumber }) %>
      </div>

      <div class="col-span-6 sm:col-span-4 relative">
        <%= render FormLabelComponent.new(form: form, name: :street_name) %>
        <%= form.text_field :street_name, autocomplete: 'street-name', data: { action: 'search#input blur->search#blur', address_search_target: 'streetName' }, class: 'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md' %>
        <div data-search-target="results">
        </div>
      </div>

      <div class="col-span-6 sm:col-span-3">
        <%= render FormLabelComponent.new(form: form, name: :suburb) %>
        <%= form.text_field :city, autocomplete: 'city', data: { address_search_target: 'suburb' }, class: 'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md' %>
      </div>

      <div class="col-span-6 sm:col-span-3">
        <%= render FormLabelComponent.new(form: form, name: :postal_code) %>
        <%= form.text_field :postal_code, autocomplete: 'postal-code', data: { address_search_target: 'postcode' }, class: 'mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md' %>
      </div>

      <div class="col-span-6 sm:col-span-6" >
        <div class="grid grid-cols-6 gap-6">
          <div class="col-span-6 sm:col-span-3">
            <%= render FormLabelComponent.new(form: form, name: :state) %>
            <%= render FormCollectionSelectComponent.new(form: form, name: :state, collection: State.all.order(:name), attribute: :name, data: { address_search_target: 'state' }) %>
          </div>

          <div class="col-span-6 sm:col-span-3">
            <%= render FormLabelComponent.new(form: form, name: :country, title: 'Country / Region') %>
            <%= render FormCollectionSelectComponent.new(form: form, name: :country, collection: ::Country.all.order(:name), attribute: :name, data: { address_search_target: 'country' }) %>
          </div>
        </div>
      </div>

    </div>
  </div>
<% end %>